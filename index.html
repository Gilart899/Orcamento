<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>GilFest ‚Äî Or√ßamentos & Contratos</title>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{--blue:#007bff;--yellow:#ffd200;--green:#25d366}
    body{font-family:Arial,Helvetica,sans-serif;background:#f6f8fb;margin:0;padding:20px}
    header{background:linear-gradient(90deg,var(--blue),#ffd500);color:#fff;padding:18px;border-radius:8px;text-align:center;font-weight:700}
    .container{max-width:900px;margin:18px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
    h2{margin:12px 0;color:var(--blue)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:220px}
    input,textarea,select{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;box-sizing:border-box}
    .category{border:1px solid #e3e6ea;border-radius:8px;overflow:hidden;margin:10px 0}
    .category-header{background:#f0f6ff;padding:10px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;font-weight:700}
    .category-content{display:none;padding:10px}
    .service{display:flex;align-items:center;gap:10px;padding:8px 4px;border-bottom:1px dashed #efefef}
    .service:last-child{border-bottom:none}
    .service input[type="checkbox"]{transform:scale(1.1)}
    .qty{margin-left:auto;display:flex;align-items:center;gap:6px}
    .qty button{padding:6px 8px;border-radius:6px;border:none;background:var(--blue);color:white;cursor:pointer}
    .small{font-size:13px;color:#555}
    .total {text-align:right;font-weight:800;font-size:18px;margin-top:12px;color:var(--blue)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn.whatsapp{background:var(--green);color:#fff}
    .btn.pdf{background:var(--blue);color:#fff}
    .btn.contract{background:#ff8a00;color:#fff}
    /* signature */
    .sig-pad{border:1px solid #ccc;border-radius:8px;height:140px;background:#fff;touch-action: none}
    label.inline{display:flex;align-items:center;gap:8px}
    footer.note{margin-top:14px;font-size:13px;color:#666}
    @media(max-width:640px){ .row{flex-direction:column} .qty{margin-left:8px} }
  </style>
</head>
<body>
  <header><span style="font-size:20px">üéâ GilFest ‚Äî Or√ßamentos & Contratos</span></header>

  <div class="container">
    <h2>Dados do Cliente</h2>
    <div class="row">
      <div class="col">
        <input id="nomeCliente" type="text" placeholder="Nome do Cliente">
      </div>
      <div class="col">
        <input id="telefoneCliente" type="tel" placeholder="Telefone (WhatsApp)">
      </div>
      <div class="col" style="max-width:200px">
        <input id="dataEvento" type="date" placeholder="Data do Evento">
      </div>
    </div>

    <div style="margin-top:8px">
      <input id="enderecoEvento" type="text" placeholder="Endere√ßo do Evento (rua, n√∫mero, bairro, cidade)">
    </div>

    <h2>Configura√ß√µes</h2>
    <div class="row">
      <div class="col" style="max-width:220px">
        <label class="small">Valor hora extra (R$)</label>
        <input id="valorHoraExtra" type="number" min="0" value="100">
      </div>
0
      
      
      <label class="small">Horas extras</label>
        <input id="horasExtras" type="number" min="0" value="0">
      </div>
      <div class="col" style="max-width:220px">
        <label class="small">Percentual de sinal (%)</label>
        <input id="percentualSinal" type="number" min="0" max="100" value="50">
      </div>
      <div class="col" style="max-width:200px">
        <label class="small">Data de emiss√£o (aparece no PDF)</label>
        <input id="dataEmissao" type="date" value="">
      </div>
    </div>

    <!-- categories -->
    <h2>Servi√ßos</h2>

    <div class="category">
      <div class="category-header" onclick="toggleCat(this)"> <span class="toggle-icon">‚ûï</span> üé™ Brinquedos </div>
      <div class="category-content">
        <div class="service">
          <input type="checkbox" data-label="Pula-pula Master (Super grande)" value="180">
          <div>Pula-pula Master (Super grande) - R$180,00</div>
        </div>
        <div class="service">
          <input type="checkbox" data-label="Pula-pula M√©dio" value="150">
          <div>Pula-pula M√©dio - R$150,00</div>
        </div>
        <div class="service">
          <input type="checkbox" data-label="Piscina de bolinhas" value="150">
          <div>Piscina de bolinhas - R$150,00</div>
        </div>
      </div>
    </div>

    <div class="category">
      <div class="category-header" onclick="toggleCat(this)"> <span class="toggle-icon">‚ûï</span> üç≠ Comidas e Guloseimas </div>
      <div class="category-content">
        <div class="service">
          <input type="checkbox" data-label="Algod√£o doce no copo 300ml" value="2.5" class="quantCheck">
          <div>Algod√£o doce no copo (300ml) - R$2,50</div>
          <div class="qty">
            <button onclick="changeSmallQty(this,-1)">-</button>
            <span class="smallQty">0</span>
            <button onclick="changeSmallQty(this,1)">+</button>
          </div>
        </div>

        <div class="service">
          <input type="checkbox" data-label="Algod√£o doce no saquinho" value="2" class="quantCheck">
          <div>Algod√£o doce no saquinho - R$2,00</div>
          <div class="qty">
            <button onclick="changeSmallQty(this,-1)">-</button>
            <span class="smallQty">0</span>
            <button onclick="changeSmallQty(this,1)">+</button>
          </div>
        </div>

        <div class="service">
          <input type="checkbox" data-label="M√°quina de Algod√£o Doce no evento" value="200">
          <div>M√°quina de Algod√£o Doce no evento - R$200,00</div>
        </div>

        <div class="service">
          <input type="checkbox" data-label="Churro (ilimitado)" value="399">
          <div>Churro (ilimitado) - R$399,00</div>
        </div>

        <div class="service">
          <input type="checkbox" data-label="Crepe Su√≠√ßo (ilimitado)" value="399">
          <div>Crepe Su√≠√ßo (ilimitado) - R$399,00</div>
        </div>
      </div>
    </div>    
<div class="service">
          <input type="checkbox" data-label="Cascata de chocolate pequena" value="399">
          <div>Cascata de chocolate pequena R$399,00</div>
        </div>
      </div>
  </div>
<div class="service">
          <input type="checkbox" data-label="Cascata de chocolate grande" value="1200">
          <div>Cascata dechocolategrande- R$1200,00</div>
        </div>
      </div>
</div>
    <div class="category">
      <div class="category-header" onclick="toggleCat(this)"><span class="toggle-icon">‚ûï</span> üéâ Extras </div>
      <div class="category-content">
        <div class="service">
          <input type="checkbox" data-label="Anima√ß√£o com bal√µes (a combinar)" value="0">
          <div>Anima√ß√£o com bal√µes (a combinar)</div>
        </div>
      </div>
    </div>

    <h2>Observa√ß√µes / Recomenda√ß√µes</h2>
    <textarea id="extra" rows="3" placeholder="Digite aqui sua observa√ß√£o e (OU) recomenda√ß√£o(ex: 2 pula-pulas + bolo)"></textarea>

    <div class="total">Total calculado: R$ <span id="totalVal">0.00</span></div>

    <div class="controls">
      <button class="btn pdf" onclick="gerarOrcamentoPDF()">üìÑ Gerar Or√ßamento (PDF)</button>
      <button class="btn contract" onclick="gerarContratoPDF()">üìë Gerar Contrato (PDF)</button>
      <button class="btn whatsapp" onclick="enviarWhatsApp()">üì≤ Enviar pelo WhatsApp</button>
    </div>

    <hr style="margin-top:18px">

    </h2>
    <img id="logoImg" src="logo.png" alt="LOGO GilFest" style="max-width:240px;border-radius:8px;display:block;margin-bottom:8px">

    <h2>Assinatura digital (cliente)</h2>
    <div>
      <canvas id="sigCanvas" class="sig-pad" width="820" height="140"></canvas>
    </div>
    <div style="margin-top:6px">
      <button onclick="clearSignature()" class="btn">Limpar assinatura</button>
      <span class="small" style="margin-left:12px;color:#666">Assine com o mouse (desktop) ou dedo (celular)</span>
    </div>

    <footer class="note">
      Observa√ß√£o: o PDF gerado aparecer√° para download no navegador   
    </footer>
  </div>

  <script>
    lucide.createIcons();
    // --- helpers ---
    function toggleCat(el){
      const content = el.nextElementSibling;
      const icon = el.querySelector('.toggle-icon');
      if(content.style.display==='block'){ content.style.display='none'; icon.textContent='‚ûï'; }
      else { content.style.display='block'; icon.textContent='‚ûñ'; }
      calcularTotal();
    }

    // small qty for algod√£o - we use .smallQty span and .quantCheck checkbox to pair
    function changeSmallQty(btn,delta){
      const serviceDiv = btn.closest('.service');
      const span = serviceDiv.querySelector('.smallQty');
      let val = parseInt(span.innerText||'0') + delta;
      if(val<0) val = 0;
      span.innerText = val;
      // make checkbox checked when quantity > 0
      const chk = serviceDiv.querySelector('input[type="checkbox"]');
      if(val>0) chk.checked = true;
      calcularTotal();
    }

    // calculate total
    function calcularTotal(){
      let total = 0;
      const services = document.querySelectorAll('.service');
      services.forEach(s=>{
        const chk = s.querySelector('input[type="checkbox"]');
        if(!chk) return;
        const preco = parseFloat(chk.value) || 0;
        const label = chk.getAttribute('data-label') || '';
        // check for smallQty
        const smallQtySpan = s.querySelector('.smallQty');
        if(smallQtySpan){
          const qtd = parseInt(smallQtySpan.innerText||'0');
          total += qtd * preco;
        } else {
          if(chk.checked) total += preco;
        }
      });

      // horas extras
      const horas = parseFloat(document.getElementById('horasExtras').value||'0');
      const valHora = parseFloat(document.getElementById('valorHoraExtra').value||'0');
      if(horas>0 && valHora>0) total += horas * valHora;

      document.getElementById('totalVal').innerText = total.toFixed(2);
      return total;
    }

    // update periodically and on interactions
    document.addEventListener('change', calcularTotal);
    document.addEventListener('input', calcularTotal);
    // also watch qty controls (already call calcularTotal)

    // --- signature pad ---
    const canvas = document.getElementById('sigCanvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    let last = {x:0,y:0};

    function resizeCanvasToDisplaySize() {
      // keep fixed size; no scaling needed
    }

    canvas.addEventListener('pointerdown',(e)=>{ drawing=true; last = {x:e.offsetX,y:e.offsetY}; });
    canvas.addEventListener('pointermove',(e)=>{ if(!drawing) return; ctx.lineWidth=2; ctx.lineCap='round'; ctx.strokeStyle='#000'; ctx.beginPath(); ctx.moveTo(last.x,last.y); ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); last={x:e.offsetX,y:e.offsetY}; });
    canvas.addEventListener('pointerup',()=>{ drawing=false; });
    canvas.addEventListener('pointerleave',()=>{ drawing=false; });

    function clearSignature(){ ctx.clearRect(0,0,canvas.width,canvas.height); }

    // --- prepare image (logo) to use in PDF ---
    function getImageDataUrl(imgEl){
      return new Promise((resolve)=>{
        if(!imgEl || !imgEl.src) return resolve(null);
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function(){
          const c = document.createElement('canvas');
          const MAXW = 180; // reduce size for PDF
          const ratio = img.width / img.height;
          const w = Math.min(MAXW, img.width);
          const h = w / ratio;
          c.width = w; c.height = h;
          const ctx2 = c.getContext('2d');
          ctx2.drawImage(img,0,0,w,h);
          resolve(c.toDataURL('image/png'));
        }
        img.onerror = ()=> resolve(null);
        img.src = imgEl.src;
      });
    }

    // --- collect items list for PDF/Whatsapp ---
    function collectItems(){
      const items = [];
      document.querySelectorAll('.service').forEach(s=>{
        const chk = s.querySelector('input[type="checkbox"]');
        if(!chk) return;
        const label = chk.getAttribute('data-label') || s.innerText.trim();
        const preco = parseFloat(chk.value) || 0;
        const smallQtySpan = s.querySelector('.smallQty');
        if(smallQtySpan){
          const qtd = parseInt(smallQtySpan.innerText||'0');
          if(qtd>0) items.push({label, qty:qtd, subtotal:(qtd*preco)});
        } else {
          if(chk.checked){
            if(preco>0) items.push({label, qty:1, subtotal:preco});
            else items.push({label, qty:1, subtotal:0});
          }
        }
      });
      // horas extras
      const horas = parseFloat(document.getElementById('horasExtras').value||'0');
      if(horas>0){
        const valHora = parseFloat(document.getElementById('valorHoraExtra').value||'0');
        items.push({label:`Hora extra x${horas}`, qty:horas, subtotal: horas*valHora});
      }
      return items;
    }

    // --- WhatsApp send ---
    function enviarWhatsApp(){
      const total = calcularTotal();
      const nome = document.getElementById('nomeCliente').value || 'N√£o informado';
      const tel = document.getElementById('telefoneCliente').value || 'N√£o informado';
      const dataEvt = document.getElementById('dataEvento').value || 'N√£o informado';
      const endereco = document.getElementById('enderecoEvento').value || 'N√£o informado';
      const extra = document.getElementById('extra').value || '';

      const items = collectItems();
      let msg = `*Or√ßamento GilFest*%0A%0A`;
      msg += `üë§ Cliente: ${nome}%0Aüìû ${tel}%0AüìÖ ${dataEvt}%0Aüìç ${endereco}%0A%0A`;
      items.forEach(it=> msg += `‚Ä¢ ${it.label} ${it.qty>1? 'x'+it.qty : ''} - R$${it.subtotal.toFixed(2)}%0A`);
      msg += `%0A*Total:* R$${total.toFixed(2)}%0A`;
      const perc = parseFloat(document.getElementById('percentualSinal').value||'0');
      const sinal = (total * (perc/100));
      msg += `Sinal (${perc}%): R$${sinal.toFixed(2)}%0A`;
      if(extra) msg += `%0AObs: ${encodeURIComponent(extra)}%0A`;

      const myNumber = '5579999145044';
      const url = `https://wa.me/${myNumber}?text=${msg}`;
      window.open(url,'_blank');
    }

    // --- generate Or√ßamento PDF ---
    async function gerarOrcamentoPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:'pt', format:'a4'});
      const nome = document.getElementById('nomeCliente').value || 'N√£o informado';
      const tel = document.getElementById('telefoneCliente').value || 'N√£o informado';
      const dataEvt = document.getElementById('dataEvento').value || 'N√£o informado';
      const endereco = document.getElementById('enderecoEvento').value || 'N√£o informado';
      const extra = document.getElementById('extra').value || '';
      const items = collectItems();
      const total = calcularTotal();
      const perc = parseFloat(document.getElementById('percentualSinal').value||'0');
      const sinal = total * (perc/100);
      const dataEmissao = (document.getElementById('dataEmissao').value) ? new Date(document.getElementById('dataEmissao').value).toLocaleDateString('pt-BR') : new Date().toLocaleDateString('pt-BR');

      // add logo if exists
      const logoEl = document.getElementById('logoImg');
      const logoData = await getImageDataUrl(logoEl);
      if(logoData) doc.addImage(logoData,'PNG',40,30,120,40);

      let y = 90;
      doc.setFontSize(16);
      doc.text("Or√ßamento GilFest", 200, 50);

      doc.setFontSize(11);
      doc.text(`Cliente: ${nome}`,40,y); y+=16;
      doc.text(`Telefone: ${tel}`,40,y); y+=16;
      doc.text(`Data do Evento: ${dataEvt}`,40,y); y+=16;
      doc.text(`Endere√ßo: ${endereco}`,40,y); y+=24;

      doc.setFontSize(12);
      items.forEach(it=>{
        doc.text(`- ${it.label} ${it.qty>1? 'x'+it.qty:''} ‚Äî R$${it.subtotal.toFixed(2)}`,40,y);
        y+=14;
        if(y>720){ doc.addPage(); y=40; }
      });

      y += 8;
      doc.setFontSize(13);
      doc.text(`Total: R$ ${total.toFixed(2)}`,40,y); y+=16;
      doc.setFontSize(11);
      doc.text(`Sinal (${perc}%): R$ ${sinal.toFixed(2)}`,40,y); y+=18;

      if(extra){
        doc.text("Observa√ß√µes:",40,y); y+=14;
        doc.text(extra,40,y); y+=18;
      }

      // rodap√©
      doc.setFontSize(10);
      doc.text("Emitido por: GilFest",40,770);
      doc.text("CPF: 045.761.515-09",40,786);
      doc.text(`Data de emiss√£o: ${dataEmissao}`,420,786);

      doc.save('orcamento_gilfest.pdf');
    }

    // --- generate Contract PDF with signature and detailed list ---
    async function gerarContratoPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:'pt', format:'a4'});
      const nome = document.getElementById('nomeCliente').value || 'N√£o informado';
      const tel = document.getElementById('telefoneCliente').value || 'N√£o informado';
      const dataEvt = document.getElementById('dataEvento').value || 'N√£o informado';
      const endereco = document.getElementById('enderecoEvento').value || 'N√£o informado';
      const extra = document.getElementById('extra').value || '';
      const items = collectItems();
      const total = calcularTotal();
      const perc = parseFloat(document.getElementById('percentualSinal').value||'0');
      const sinal = total * (perc/100);
      const dataEmissao = (document.getElementById('dataEmissao').value) ? new Date(document.getElementById('dataEmissao').value).toLocaleDateString('pt-BR') : new Date().toLocaleDateString('pt-BR');

      // logo
      const logoEl = document.getElementById('logoImg');
      const logoData = await getImageDataUrl(logoEl);
      if(logoData) doc.addImage(logoData,'PNG',40,30,120,40);

      let y = 90;
      doc.setFontSize(14);
      doc.text("CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS", 200, 50);
      doc.setFontSize(11);
      doc.text(`CONTRATADO: GilFest ‚Äî CPF 045.761.515-09`,40,y); y+=16;
      doc.text(`Endere√ßo do CONTRATADO: Conjunto Jo√£o Alves, n¬∫705 ‚Äî Nossa Senhora do Socorro/SE`,40,y); y+=20;
      doc.text(`CONTRATANTE: ${nome}`,40,y); y+=16;
      doc.text(`Telefone: ${tel}`,40,y); y+=16;
      doc.text(`Endere√ßo do Evento: ${endereco}`,40,y); y+=16;
      doc.text(`Data do Evento: ${dataEvt}`,40,y); y+=20;

      doc.setFontSize(12);
      doc.text("CL√ÅUSULA 1¬™ ‚Äì DO OBJETO",40,y); y+=14;
      doc.setFontSize(11);
      doc.text("Presta√ß√£o de servi√ßos de recrea√ß√£o e/ou fornecimento de itens conforme or√ßamento, com dura√ß√£o de 04 (quatro) horas.",40,y); y+=18;

      doc.setFontSize(12);
      doc.text("CL√ÅUSULA 2¬™ ‚Äì OBRIGA√á√ïES DO CONTRATADO",40,y); y+=14;
      doc.setFontSize(11);
      doc.text("Disponibilizar os servi√ßos e equipamentos conforme descrito no or√ßamento.",40,y); y+=18;

      doc.setFontSize(12);
      doc.text("CL√ÅUSULA 3¬™ ‚Äì OBRIGA√á√ïES DO CONTRATANTE",40,y); y+=14;
      doc.setFontSize(11);
      doc.text("Efetuar pagamento conforme acordado e fornecer local adequado para montagem.",40,y); y+=18;

      doc.setFontSize(12);
      doc.text("CL√ÅUSULA 4¬™ ‚Äì RESCIS√ÉO",40,y); y+=14;
      doc.setFontSize(11);
      doc.text("Desist√™ncias devem ser comunicadas com anteced√™ncia m√≠nima de 7 dias. Reten√ß√µes podem ocorrer conforme valores pagos.",40,y); y+=20;

      doc.setFontSize(12);
      doc.text("VALOR DO CONTRATO",40,y); y+=14;
      doc.setFontSize(12);
      doc.text(`Valor total do contrato: R$ ${total.toFixed(2)}`,40,y); y+=18;
      doc.text(`Sinal (${perc}%): R$ ${sinal.toFixed(2)} ‚Äî restante a pagar conforme combinado.`,40,y); y+=20;

      // services list
      doc.setFontSize(12);
      doc.text("Servi√ßos contratados:",40,y); y+=14;
      doc.setFontSize(11);
      items.forEach(it=>{
        doc.text(`- ${it.label} ${it.qty?(' x'+it.qty):''} ‚Äî R$${it.subtotal.toFixed(2)}`,45,y);
        y+=12;
        if(y>700){ doc.addPage(); y=40; }
      });

      if(extra){ y+=8; doc.text("Observa√ß√µes: "+extra,40,y); y+=16; }

      // draw signature image from canvas
      const sigData = canvas.toDataURL('image/png');
      if(sigData){
        // place signature near bottom
        const sigX = 60;
        let sigY = 650;
        doc.addImage(sigData,'PNG',sigX,sigY,220,70);
        doc.text("CONTRATANTE ‚Äî Assinatura Digital", sigX, sigY + 85);
      } else {
        // blank line
        doc.text("__________________________________________",40,680);
        doc.text("CONTRATANTE ‚Äî Assinatura Digital",40,696);
      }

      // company signature
      doc.text("__________________________________________",320,680);
      doc.text("GilFest ‚Äî CONTRATADO",320,696);
      doc.text("CPF: 045.761.515-09",320,712);

      doc.setFontSize(10);
      doc.text(`Local: Nossa Senhora do Socorro - SE    Data de emiss√£o: ${dataEmissao}`,40,760);

      doc.save('contrato_gilfest.pdf');
    }

    // initial update
    calcularTotal();
  </script>
</body>
          </html>
