<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GilFest ‚Äî Or√ßamentos & Contratos</title>
  <meta name="description" content="GilFest ‚Äî Ferramenta de or√ßamento e contrato com assinatura digital e exporta√ß√£o em PDF">
  <style>
    :root{
      --accent:#0d6efd;
      --muted:#666;
      --bg:#fff;
    }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:#f4f6f9; color:#111}
    .container{max-width:980px;margin:18px auto;padding:18px;background:var(--bg);border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    .header{display:flex;gap:12px;align-items:center}
    .logo{width:64px;height:64px;object-fit:contain}
    h1{font-size:1.25rem;margin:0}
    .lead{margin:0;color:var(--muted);font-size:.95rem}
    section{margin-top:18px}
    h2{font-size:1.05rem;margin:8px 0}
    .row{display:grid;grid-template-columns:1fr;gap:10px}
    label{font-size:.85rem;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"], input[type="number"], input[type="date"], input[type="tel"], select{
      padding:8px;border-radius:8px;border:1px solid #e3e6ea;width:100%;background:#fff
    }
    .config-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .categoria{margin-top:8px}
    .item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px;border-radius:8px;border:1px solid #eee;background:#fcfdff;margin-top:8px}
    .item-left{display:flex;align-items:center;gap:10px;flex:1}
    .item-checkbox{transform:scale(1.1)}
    .item-title{font-weight:600}
    .qty{display:flex;align-items:center;gap:6px}
    .qty button{padding:6px 8px;border-radius:6px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .qty input{width:62px;padding:6px;border-radius:6px;border:1px solid #ddd;text-align:center}
    .preco{min-width:100px;text-align:right;color:var(--muted);font-weight:600}
    #resumo{background:#f1f3f9;padding:12px;border-radius:8px;margin-top:12px}
    .actions{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .actions button{padding:10px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .actions button.secondary{background:#28a745}
    .sigWrap{margin-top:12px}
    canvas#signature-pad{border:1px solid #dcdcdc;border-radius:6px;display:block;max-width:100%}
    .sigActions{display:flex;gap:8px;margin-top:8px}
    .sigActions button{padding:8px 10px;border-radius:6px;border:0;cursor:pointer}
    .muted{color:var(--muted);font-size:.95rem}
    @media(min-width:720px){
      .row{grid-template-columns:repeat(3,1fr)}
      .actions{flex-direction:row}
      .config-grid{grid-template-columns:repeat(3,1fr)}
    }
  </style>
</head>
<body>
  <main class="container" role="main">
    <header class="header" aria-label="Cabe√ßalho">
      <img src="logo.png" alt="Logo GilFest" class="logo" />
      <div>
        <h1>GilFest ‚Äî Or√ßamentos & Contratos</h1>
        <p class="lead">Gere or√ßamento e contrato com assinatura digital e exporte em PDF.</p>
        <p class="muted">CPF: <strong>045.761.515-09</strong> ‚Ä¢ Tel: <strong>(79) 9 9914-5044</strong></p>
        <p class="muted">Endere√ßo: <strong>Av. Principal do conjunto Jo√£o Alves, n¬∞705 ‚Äî Nossa Senhora do Socorro - SE</strong></p>
      </div>
    </header>

    <form id="orcForm" novalidate>
      <section aria-labelledby="cliente-title">
        <h2 id="cliente-title">Dados do Cliente</h2>
        <div class="row">
          <div>
            <label for="clienteNome">Nome</label>
            <input id="clienteNome" type="text" placeholder="Ex: Jo√£o Silva" />
          </div>
          <div>
            <label for="clienteTelefone">Telefone</label>
            <input id="clienteTelefone" type="tel" placeholder="(99) 99999-9999" />
          </div>
          <div>
            <label for="dataEvento">Data do Evento</label>
            <input id="dataEvento" type="date" />
          </div>
        </div>
      </section>

      <section aria-labelledby="config-title">
        <h2 id="config-title">Configura√ß√µes (fixas)</h2>
        <div class="config-grid">
          <div>
            <label for="valorHoraExtra">Valor hora extra (R$) ‚Äî fixo</label>
            <input id="valorHoraExtra" type="number" value="100.00" readonly />
          </div>
          <div>
            <label for="percentualSinal">Percentual de sinal (%) ‚Äî fixo</label>
            <input id="percentualSinal" type="number" value="40" readonly />
          </div>
          <div>
            <label for="observacoes">Observa√ß√µes (opcional)</label>
            <input id="observacoes" type="text" placeholder="Ex: Local com acesso a energia el√©trica" />
          </div>
        </div>
      </section>

      <section aria-labelledby="servicos-title">
        <h2 id="servicos-title">Servi√ßos</h2>

        <div class="categoria" id="categoria-comidas">

  <!-- ====== COMIDAS E GULOSEIMAS ====== -->
<div class="categoria" id="categoria-comidas-guloseimas">
  
</div>
          <!-- Guloseimas Extras -->
<h3>üç¨ Guloseimas Extras</h3>

<div class="item">
  <label>
    <input type="checkbox" class="item-checkbox" data-name="Algod√£o doce no saquinho" data-price="2">
    Algod√£o doce no saquinho (R$2,00)
  </label>
  <div class="qty-control">
    <button type="button" class="btn-minus">-</button>
    <input type="number" class="item-qty" value="0" min="0" style="width:50px; text-align:center">
    <button type="button" class="btn-plus">+</button>
  </div>
</div>

<div class="item">
  <label>
    <input type="checkbox" class="item-checkbox" data-name="Pipoca gourmet 300ml" data-price="5">
    Pipoca gourmet copo 300ml (R$5,00)
  </label>
  <div class="qty-control">
    <button type="button" class="btn-minus">-</button>
    <input type="number" class="item-qty" value="0" min="0" style="width:50px; text-align:center">
    <button type="button" class="btn-plus">+</button>
  </div>
</div>

<div class="item">
  <label>
    <input type="checkbox" class="item-checkbox" data-name="Pipoca caramelizada 300ml" data-price="2">
    Pipoca caramelizada copo 300ml (R$2,00)
  </label>
  <div class="qty-control">
    <button type="button" class="btn-minus">-</button>
    <input type="number" class="item-qty" value="0" min="0" style="width:50px; text-align:center">
    <button type="button" class="btn-plus">+</button>
  </div>
</div>

<!-- Exibir total -->
<p id="total" style="font-weight:bold; font-size:18px; margin-top:10px;">Total: R$ 0,00</p>

<!-- Bot√µes -->
<button id="btn-whatsapp">üì≤ Enviar Or√ßamento via WhatsApp</button>
<button id="btn-pdf">üìÑ Gerar Or√ßamento em PDF</button>

  <!-- Algod√£o doce no copo 300ml -->
  <div class="item" data-preco="2.50" data-id="algodao-copo-300">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="Algod√£o doce no copo 300ml" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#ff69b4;margin-right:6px;"></i>
          Algod√£o doce no copo (300ml)
        </div>
        <div class="muted">R$ 2,50 cada</div>
      </div>
    </div>
    <div class="qty">
      <button type="button" class="qty-dec">‚àí</button>
      <input type="number" class="qty-input" value="0" min="0" />
      <button type="button" class="qty-inc">+</button>
    </div>
    <div class="preco">R$ 2,50</div>
  </div>

  <!-- Algod√£o doce no copo 500ml -->
  <div class="item" data-preco="3.50" data-id="algodao-copo-500">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="Algod√£o doce no copo 500ml" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#ff69b4;margin-right:6px;"></i>
          Algod√£o doce no copo (500ml)
        </div>
        <div class="muted">R$ 3,50 cada</div>
      </div>
    </div>
    <div class="qty">
      <button type="button" class="qty-dec">‚àí</button>
      <input type="number" class="qty-input" value="0" min="0" />
      <button type="button" class="qty-inc">+</button>
    </div>
    <div class="preco">R$ 3,50</div>
  </div>

  <!-- M√°quina de algod√£o doce no evento -->
  <div class="item" data-preco="200.00" data-id="maquina-algodao">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="M√°quina de algod√£o doce no evento" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#ff69b4;margin-right:6px;"></i>
          M√°quina de algod√£o doce no evento
        </div>
        <div class="muted">R$ 200,00</div>
      </div>
    </div>
    <div class="preco">R$ 200,00</div>
  </div>

  <!-- Combo infantil b√°sico -->
  <div class="item" data-preco="499.00" data-id="combo-infantil">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="Combo infantil b√°sico" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#32cd32;margin-right:6px;"></i>
          Combo infantil b√°sico (pula-pula + algod√£o doce + pipoca)
        </div>
        <div class="muted">R$ 499,00</div>
      </div>
    </div>
    <div class="preco">R$ 499,00</div>
  </div>

  <!-- Combo completo -->
  <div class="item" data-preco="550.00" data-id="combo-completo">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="Combo completo" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#228b22;margin-right:6px;"></i>
          Combo completo (pula-pula, piscina de bolinhas, algod√£o doce e pipoca)
        </div>
        <div class="muted">R$ 550,00</div>
      </div>
    </div>
    <div class="preco">R$ 550,00</div>
  </div>
</div>

<!-- ====== BRINQUEDOS ====== -->
<div class="categoria" id="categoria-brinquedos">
  <h3>Brinquedos</h3>

  <!-- Pula-pula grande -->
  <div class="item" data-preco="180.00" data-id="pula-pula-grande">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="Pula-pula grande" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#1e90ff;margin-right:6px;"></i>
          Pula-pula grande
        </div>
        <div class="muted">R$ 180,00</div>
      </div>
    </div>
    <div class="preco">R$ 180,00</div>
  </div>

  <!-- Pula-pula m√©dio -->
  <div class="item" data-preco="150.00" data-id="pula-pula-medio">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="Pula-pula m√©dio" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#1e90ff;margin-right:6px;"></i>
          Pula-pula m√©dio
        </div>
        <div class="muted">R$ 150,00</div>
      </div>
    </div>
    <div class="preco">R$ 150,00</div>
  </div>

  <!-- Piscina de bolinhas -->
  <div class="item" data-preco="150.00" data-id="piscina-bolinhas">
    <div class="item-left">
      <input class="item-checkbox" type="checkbox" aria-label="Piscina de bolinhas" />
      <div>
        <div class="item-title">
          <i class="fas fa-comments" style="color:#1e90ff;margin-right:6px;"></i>
          Piscina de bolinhas
        </div>
        <div class="muted">R$ 150,00</div>
      </div>
    </div>
    <div class="preco">R$ 150,00</div>
  </div>
</div>
</div>

<script>
  // Atualiza o total automaticamente
  function atualizarTotal() {
    let total = 0;
    document.querySelectorAll(".item").forEach(item => {
      const checkbox = item.querySelector(".item-checkbox");
      const qtdInput = item.querySelector(".qty-input");
      const preco = parseFloat(item.dataset.preco);
      if (checkbox && checkbox.checked) {
        const qtd = qtdInput ? parseInt(qtdInput.value) || 0 : 1;
        total += preco * qtd;
      }
    });

    const campoTotal = document.getElementById("total_valor");
    if (campoTotal) campoTotal.textContent = "R$ " + total.toFixed(2).replace(".", ",");
  }

  // Liga eventos aos itens
  document.querySelectorAll(".item").forEach(item => {
    const checkbox = item.querySelector(".item-checkbox");
    const dec = item.querySelector(".qty-dec");
    const inc = item.querySelector(".qty-inc");
    const input = item.querySelector(".qty-input");

    if (checkbox) checkbox.addEventListener("change", atualizarTotal);
    if (input) input.addEventListener("input", atualizarTotal);

    if (dec && input) dec.addEventListener("click", () => {
      if (parseInt(input.value) > 0) input.value = parseInt(input.value) - 1;
      atualizarTotal();
    });
    if (inc && input) inc.addEventListener("click", () => {
      input.value = parseInt(input.value) + 1;
      checkbox.checked = true;
      atualizarTotal();
    });
  });
</script>
          
   
        </div>
      </section>

      <section id="resumo" aria-live="polite">
        <h2>Resumo</h2>
        <div id="subtotais" class="muted">Nenhum servi√ßo selecionado.</div>
        <div id="total" style="margin-top:8px;font-weight:700">Total calculado: R$ <span id="totalValue">0,00</span></div>
        <div id="sinalInfo" style="margin-top:6px">Sinal (40%): R$ <span id="sinalValue">0,00</span> ‚Ä¢ Saldo: R$ <span id="saldoValue">0,00</span></div>
      </section>

      <div class="actions" style="margin-top:14px">
        <button id="gerarOrcamento" type="button">Gerar Or√ßamento (PDF) + Abrir WhatsApp</button>
        <button id="gerarContrato" type="button" class="secondary">Gerar Contrato (PDF) + Abrir WhatsApp</button>
        <button id="enviarWhats" type="button" style="background:#25d366">Enviar Resumo pelo WhatsApp</button>
      </div>
    </form>

    <section class="sigWrap" aria-labelledby="sig-title">
      <h2 id="sig-title">Assinatura digital (cliente)</h2>
      <canvas id="signature-pad" width="700" height="160" aria-label="√Årea para assinatura"></canvas>
      <div class="sigActions">
        <button id="clearSig" type="button" style="background:#dc3545;color:#fff">Limpar assinatura</button>
        <button id="saveSig" type="button" style="background:#007bff;color:#fff">Salvar assinatura</button>
        <span id="sigStatus" class="muted" style="align-self:center">consultar frete.</span>
      </div>
    </section>

  </main>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

  <script>
  (function(){
    // n√∫mero de WhatsApp alvo (formato internacional sem sinais): +55 79 9 9914 5044 => 5579999145044
    const WHATS_NUMBER = '5579999145044';

    const itens = Array.from(document.querySelectorAll('.item'));
    const totalValueEl = document.getElementById('totalValue');
    const sinalValueEl = document.getElementById('sinalValue');
    const saldoValueEl = document.getElementById('saldoValue');
    const subtotaisEl = document.getElementById('subtotais');
    const percentualInput = document.getElementById('percentualSinal'); // fixo 40
    const valorHoraExtraInput = document.getElementById('valorHoraExtra'); // fixo 100
    const clienteNomeEl = document.getElementById('clienteNome');
    const clienteTelEl = document.getElementById('clienteTelefone');
    const dataEventoEl = document.getElementById('dataEvento');
    const obsEl = document.getElementById('observacoes');

    // SignaturePad
    const canvas = document.getElementById('signature-pad');
    const sigStatus = document.getElementById('sigStatus');
    const signaturePad = new SignaturePad(canvas, {backgroundColor: 'rgba(255,255,255,0)', penColor: 'rgb(0,0,0)'});
    document.getElementById('clearSig').addEventListener('click', () => {
      signaturePad.clear();
      window.__sigData = null;
      sigStatus.textContent = 'Nenhuma assinatura salva.';
    });
    document.getElementById('saveSig').addEventListener('click', () => {
      if(signaturePad.isEmpty()){
        alert('Assine primeiro antes de salvar.');
        return;
      }
      window.__sigData = signaturePad.toDataURL('image/png');
      sigStatus.textContent = 'Assinatura salva (ser√° inserida no PDF).';
    });

    // formata√ß√£o moeda pt-br
    function currencyBr(v){
      return Number(v || 0).toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});
    }

    // retorna dados do item
    function getItemData(itemEl){
      const preco = Number(itemEl.dataset.preco) || 0;
      const id = itemEl.dataset.id || '';
      const title = (itemEl.querySelector('.item-title') || itemEl.querySelector('label') || {textContent: id}).textContent.trim();
      const checked = itemEl.querySelector('.item-checkbox').checked;
      const qtyInput = itemEl.querySelector('.qty-input');
      const qty = qtyInput ? Math.max(0, Number(qtyInput.value || 0)) : 1;
      const total = preco * (qtyInput ? qty : (checked ? 1 : 0));
      return { id, title, preco, qty: qtyInput ? qty : 1, checked, total, hasQty: !!qtyInput };
    }

    // criar controles de +/-
    itens.forEach(item => {
      const inc = item.querySelector('.qty-inc');
      const dec = item.querySelector('.qty-dec');
      const qtyInput = item.querySelector('.qty-input');
      // Se o item n√£o tem campo qty (qtyInput undefined), esconda controles (mas no markup atual todos tem)
      if(!qtyInput){
        if(inc) inc.style.display='none';
        if(dec) dec.style.display='none';
      } else {
        inc.addEventListener('click', () => { qtyInput.value = String(Math.max(0, Number(qtyInput.value || 0) + 1)); calcular(); });
        dec.addEventListener('click', () => { qtyInput.value = String(Math.max(0, Number(qtyInput.value || 0) - 1)); calcular(); });
        qtyInput.addEventListener('input', () => {
          if(qtyInput.value === '') qtyInput.value = '0';
          if(Number(qtyInput.value) < 0) qtyInput.value = '0';
          calcular();
        });
      }
      const cb = item.querySelector('.item-checkbox');
      if(cb) cb.addEventListener('change', calcular);
    });

    // c√°lculo principal
    function calcular(){
      const selecionados = [];
      let subtotal = 0;
      itens.forEach(item => {
        const d = getItemData(item);
        if(d.checked){
          selecionados.push(d);
          subtotal += d.total;
        }
      });

      if(selecionados.length === 0){
        subtotaisEl.textContent = 'Nenhum servi√ßo selecionado.';
      } else {
        // montar string de subtotais por item
        const lines = selecionados.map(s => {
          return `${s.title}${s.hasQty ? ` ‚Äî ${s.qty} x R$ ${currencyBr(s.preco)} = R$ ${currencyBr(s.total)}` : ` ‚Äî R$ ${currencyBr(s.preco)}`}`;
        });
        subtotaisEl.innerHTML = lines.join('<br/>');
      }

      const percentual = Number(percentualInput.value) || 0;
      const sinal = subtotal * percentual / 100;
      const saldo = subtotal - sinal;

      totalValueEl.textContent = currencyBr(subtotal);
      sinalValueEl.textContent = currencyBr(sinal);
      saldoValueEl.textContent = currencyBr(saldo);
    }

    // bind calculo a inputs fixos (mesmo que read-only)
    percentualInput.addEventListener('input', calcular);
    valorHoraExtraInput.addEventListener('input', calcular);

    // inicializa
    calcular();

    // gerar PDF (orcamento ou contrato)
    async function gerarPDF(comContrato){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:'pt',format:'a4'});
      const marginLeft = 40;
      let y = 40;
      const clienteNome = (clienteNomeEl.value || '---').trim();
      const clienteTel = (clienteTelEl.value || '---').trim();
      const dataEvento = (dataEventoEl.value || '---');
      const observacoes = (obsEl.value || '');

      // Cabe√ßalho (seus dados fixos)
      doc.setFontSize(12);
      doc.text('GILFEST ‚Äî Or√ßamentos & Contratos', marginLeft, y); y += 18;
      doc.setFontSize(10);
      doc.text('Contratado: GilFest', marginLeft, y); y += 14;
      doc.text('CPF: 045.761.515-09', marginLeft, y); y += 14;
      doc.text('Telefone: (79) 9 9914-5044', marginLeft, y); y += 14;
      doc.text('Endere√ßo: Av. Principal do conjunto Jo√£o Alves, n¬∞705 ‚Äî Nossa Senhora do Socorro - SE', marginLeft, y); y += 20;

      // Dados do cliente
      doc.setFontSize(11);
      doc.text(`Cliente: ${clienteNome}`, marginLeft, y); y += 14;
      doc.text(`Telefone (cliente): ${clienteTel}`, marginLeft, y); y += 14;
      doc.text(`Data do evento: ${dataEvento}`, marginLeft, y); y += 18;

      // Tabela de itens
      const selecionados = itens.map(getItemData).filter(d => d.checked && d.total > 0);
      if(selecionados.length > 0){
        const tableBody = selecionados.map(s => {
          const descricao = s.hasQty ? `${s.title} (x${s.qty})` : s.title;
          return [descricao, `R$ ${currencyBr(s.preco)}`, s.hasQty ? String(s.qty) : '-', `R$ ${currencyBr(s.total)}`];
        });

        doc.autoTable({
          startY: y,
          head: [['Servi√ßo/Produto','Unit.','Qtd','Total']],
          body: tableBody,
          styles:{fontSize:10},
          headStyles:{fillColor:[13,110,253], textColor:255}
        });
        y = (doc.lastAutoTable && doc.lastAutoTable.finalY) ? doc.lastAutoTable.finalY + 10 : y + 120;
      } else {
        doc.text('Nenhum servi√ßo selecionado.', marginLeft, y); y += 18;
      }

      // Resumo financeiro
      const subtotal = selecionados.reduce((s,i)=>s+i.total,0);
      const percentual = Number(percentualInput.value) || 0;
      const sinal = subtotal * percentual / 100;
      const saldo = subtotal - sinal;
      doc.setFontSize(11);
      doc.text(`Subtotal: R$ ${currencyBr(subtotal)}`, marginLeft, y); y += 16;
      doc.text(`Sinal (${percentual}%): R$ ${currencyBr(sinal)}`, marginLeft, y); y += 16;
      doc.text(`Saldo a pagar: R$ ${currencyBr(saldo)}`, marginLeft, y); y += 20;

      // Observa√ß√µes e horas extras
      const horaExtra = Number(valorHoraExtraInput.value || 0);
      doc.text(`Valor hora extra (por hora): R$ ${currencyBr(horaExtra)}`, marginLeft, y); y += 16;
      if(observacoes) {
        doc.text('Observa√ß√µes:', marginLeft, y); y += 14;
        doc.setFontSize(10);
        doc.text(observacoes, marginLeft, y, {maxWidth:480}); y += 30;
      } else {
        y += 6;
      }

      // Se contrato, inserir cl√°usulas
      if(comContrato){
        doc.setFontSize(12);
        doc.text('CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS ‚Äî CL√ÅUSULAS B√ÅSICAS', marginLeft, y); y += 18;
        doc.setFontSize(10);
        const clausulas = [
          '1. Objeto: Contrata√ß√£o dos servi√ßos descritos neste documento para realiza√ß√£o de evento na data informada.',
          '2. Valor e Pagamento: O valor total corresponde ao subtotal. O contratante pagar√° sinal de 40% para garantia da reserva; o saldo dever√° ser pago conforme acordado.',
          '3. Horas extras: As horas adicionais ser√£o cobradas √† raz√£o de R$ ' + currencyBr(horaExtra) + ' por hora.',
          '4. Cancelamento: Em caso de cancelamento, poder√° haver reten√ß√£o do sinal conforme acordo entre as partes.',
          '5. Responsabilidades: O contratado fornecer√° os servi√ßos descritos; o contratante deve prover local adequado, acesso √† energia quando necess√°rio, e seguran√ßa.',
          '6. Foro: As partes elegem o foro da comarca local para dirimir eventuais d√∫vidas.'
        ];
        clausulas.forEach(text => {
          doc.text(text, marginLeft, y, {maxWidth:500});
          y += 14;
        });
      }

      // Assinaturas
      y += 18;
      doc.text('Assinaturas:', marginLeft, y); y += 18;
      if(window.__sigData){
        doc.addImage(window.__sigData, 'PNG', marginLeft, y, 180, 54);
        doc.text('Assinatura do Cliente', marginLeft, y + 70);
      } else {
        doc.text('_______________________________    _______________________________', marginLeft, y);
        doc.text('Assinatura do Contratante                Assinatura do Contratado', marginLeft, y + 16);
      }

      // salvar pdf
      const tipo = comContrato ? 'Contrato' : 'Orcamento';
      const filename = `${tipo}_${(clienteNome || 'Cliente').replace(/\s+/g,'_')}.pdf`;
      doc.save(filename);

      // ap√≥s salvar, abrir WhatsApp com mensagem resumida para o n√∫mero fixo
      // montar mensagem curta com os principais dados
      const mensagem = montarMensagemWhats({tipo, clienteNome, clienteTel, dataEvento, selecionados, subtotal, sinal, saldo});
      // abre em nova aba
      const waUrl = `https://wa.me/${WHATS_NUMBER}?text=${encodeURIComponent(mensagem)}`;
      window.open(waUrl, '_blank');
    }

    // helper monta mensagem
    function montarMensagemWhats({tipo, clienteNome, clienteTel, dataEvento, selecionados, subtotal, sinal, saldo}){
      const header = `Ol√°, segue ${tipo.toLowerCase()} gerado por GilFest.\n`;
      const cliente = `Cliente: ${clienteNome}\nTelefone: ${clienteTel || '---'}\nData do evento: ${dataEvento || '---'}\n\n`;
      const itensTxt = (selecionados.length > 0) ? selecionados.map(s => {
        return `${s.title}${s.hasQty ? ' x' + s.qty : ''} ‚Äî R$ ${currencyBr(s.total)}`;
      }).join('\n') + '\n\n' : 'Nenhum item selecionado.\n\n';
      const valores = `Subtotal: R$ ${currencyBr(subtotal)}\nSinal (40%): R$ ${currencyBr(sinal)}\nSaldo: R$ ${currencyBr(saldo)}\n\n`;
      const footer = 'PDF gerado no navegador. Para enviar o PDF em anexo √© necess√°rio transferi-lo manualmente ou usar integra√ß√£o com API.\nAtenciosamente,\nGilFest';
      return header + cliente + itensTxt + valores + footer;
    }

    // bot√£o gerar or√ßamento / contrato
    document.getElementById('gerarOrcamento').addEventListener('click', () => gerarPDF(false));
    document.getElementById('gerarContrato').addEventListener('click', () => gerarPDF(true));

    // bot√£o enviar resumo WhatsApp (apenas abre chat com resumo atual)
    document.getElementById('enviarWhats').addEventListener('click', () => {
      const clienteNome = clienteNomeEl.value || 'Cliente';
      const clienteTel = clienteTelEl.value || '';
      const dataEvento = dataEventoEl.value || '';
      const selecionados = itens.map(getItemData).filter(i => i.checked && i.total > 0);
      const subtotal = selecionados.reduce((s,i)=>s+i.total,0);
      const percentual = Number(percentualInput.value) || 0;
      const sinal = subtotal * percentual / 100;
      const saldo = subtotal - sinal;
      const mensagem = montarMensagemWhats({tipo: 'Resumo', clienteNome, clienteTel, dataEvento, selecionados, subtotal, sinal, saldo});
      const waUrl = `https://wa.me/${WHATS_NUMBER}?text=${encodeURIComponent(mensagem)}`;
      window.open(waUrl, '_blank');
    });

    // recalcular sempre que algo muda (delegation)
    document.querySelectorAll('.item-checkbox, .qty-input').forEach(el => {
      el.addEventListener('change', calcular);
      el.addEventListener('input', calcular);
    });

    // calcula inicialmente
    calcular();
  })();
  </script>
  <!-- Bot√£o Instagram fixo -->
  <a href="https://www.instagram.com/invites/contact/?i=168wzlip0gszo&utm_content=kc54z9" target="_blank" 
     style="position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            color: #fff;
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 30px;
            text-decoration: none;
            font-family: Arial, sans-serif;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s;">
     üì∏ Instagram
  </a>
</body>
</html>

<!-- Bot√£o PIX no canto superior esquerdo -->
<div id="pix-container"
     style="position: fixed; top: 20px; left: 20px;
            display: flex; flex-direction: column; align-items: center;
            text-decoration: none; cursor: pointer; z-index: 9999;">
  
  <!-- Bot√£o circular -->
  <a id="pix-button" 
     style="width: 60px; height: 60px; background: #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2); transition: transform 0.15s;">
    <!-- Logo Pix SVG -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="34" height="34">
      <path fill="#32BCAD" d="M183.2 21.3L78.5 126c-28.7 28.7-28.7 75.3 0 104l104.7 104.7c28.7 28.7 75.3 28.7 104 0l104.7-104.7c28.7-28.7 28.7-75.3 0-104L287.2 21.3c-28.6-28.4-75.3-28.4-104 0z"/>
      <path fill="#32BCAD" d="M328.8 490.7l104.7-104.7c28.7-28.7 28.7-75.3 0-104L328.8 177.3c-28.7-28.7-75.3-28.7-104 0L120.1 282c-28.7 28.7-28.7 75.3 0 104l104.7 104.7c28.7 28.7 75.3 28.7 104 0z"/>
    </svg>
  </a>

  <!-- Texto embaixo -->
  <span style="margin-top: 6px; font-size: 14px; font-family: Arial; color: #333;">
    Copiar Pix
  </span>
</div>

<!-- Tooltip de confirma√ß√£o -->
<div id="pix-tooltip" 
     style="position: fixed; top: 100px; left: 20px;
            background:#222; color:#fff; padding:8px 12px; border-radius:8px;
            font-family:Arial, sans-serif; font-size:14px; display:none;
            box-shadow:0 6px 16px rgba(0,0,0,0.25); z-index:10000;">
  Chave PIX copiada!
</div>

<script>
(function(){
  var pixKeyDigits = "58847235553"; // sua chave PIX CPF

  function formatCPF(digits){
    if(!digits || digits.length !== 11) return digits;
    return digits.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
  }

  var btn = document.getElementById("pix-button");
  var tip = document.getElementById("pix-tooltip");

  function showTooltip(msg, timeMs){
    tip.textContent = msg;
    tip.style.display = "block";
    tip.style.opacity = "1";
    clearTimeout(tip._timeout);
    tip._timeout = setTimeout(function(){
      tip.style.transition = "opacity 150ms";
      tip.style.opacity = "0";
      setTimeout(function(){ tip.style.display = "none"; tip.style.transition = ""; }, 160);
    }, timeMs || 1600);
  }

  function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      return navigator.clipboard.writeText(text);
    } else {
      return new Promise(function(resolve, reject){
        var ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        try{
          var ok = document.execCommand("copy");
          document.body.removeChild(ta);
          if(ok) resolve(); else reject();
        } catch(e){
          document.body.removeChild(ta);
          reject(e);
        }
      });
    }
  }

  btn.addEventListener("click", function(e){
    e.preventDefault();
    copyToClipboard(pixKeyDigits).then(function(){
      showTooltip("Chave PIX copiada: " + formatCPF(pixKeyDigits), 1800);
      btn.style.transform = "scale(0.95)";
      setTimeout(function(){ btn.style.transform = ""; }, 150);
    }).catch(function(){
      showTooltip("Erro: copie manualmente: " + formatCPF(pixKeyDigits), 2500);
    });
  });
})();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function calcularTotal() {
  let total = 0;
  document.querySelectorAll('.item-checkbox').forEach((chk, i) => {
    const qtyInput = document.querySelectorAll('.item-qty')[i];
    const qty = parseInt(qtyInput.value) || 0;
    if (chk.checked && qty > 0) {
      const price = parseFloat(chk.dataset.price);
      total += price * qty;
    }
  });
  document.getElementById('total').textContent = "Total: R$ " + total.toFixed(2);
  return total;
}

// A√ß√µes dos bot√µes + e -
document.querySelectorAll('.btn-plus').forEach((btn, i) => {
  btn.addEventListener('click', () => {
    const qtyInput = document.querySelectorAll('.item-qty')[i];
    qtyInput.value = parseInt(qtyInput.value) + 1;
    document.querySelectorAll('.item-checkbox')[i].checked = true;
    calcularTotal();
  });
});

document.querySelectorAll('.btn-minus').forEach((btn, i) => {
  btn.addEventListener('click', () => {
    const qtyInput = document.querySelectorAll('.item-qty')[i];
    if (parseInt(qtyInput.value) > 0) {
      qtyInput.value = parseInt(qtyInput.value) - 1;
    }
    calcularTotal();
  });
});

// Atualizar ao marcar/desmarcar ou digitar quantidade
document.querySelectorAll('.item-checkbox, .item-qty').forEach(el => {
  el.addEventListener('input', calcularTotal);
});

// Enviar or√ßamento pelo WhatsApp
document.getElementById('btn-whatsapp').addEventListener('click', () => {
  let msg = "üìã *Or√ßamento GilFest*\n\n";
  document.querySelectorAll('.item-checkbox').forEach((chk, i) => {
    const qty = parseInt(document.querySelectorAll('.item-qty')[i].value) || 0;
    if (chk.checked && qty > 0) {
      msg += `‚Ä¢ ${chk.dataset.name} x${qty} = R$ ${(chk.dataset.price * qty).toFixed(2)}\n`;
    }
  });
  msg += "\nüí∞ Total: R$ " + calcularTotal().toFixed(2);
  const url = "https://wa.me/5579999145044?text=" + encodeURIComponent(msg);
  window.open(url, "_blank");
});

// Gerar PDF
document.getElementById('btn-pdf').addEventListener('click', () => {
  const element = document.body;
  html2pdf().set({
    margin: 10,
    filename: 'orcamento-gilfest.pdf',
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  }).from(element).save();
});
</script>

</body>
</html>
