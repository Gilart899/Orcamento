<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Orçamento GilFest</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide-static"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      background: url('Criação do Messenger_975205B6-7357-4AD1-B270-6510521D72F2.png') no-repeat center center fixed;
      background-size: 50%;
      opacity: 0.95;
    }
    #signaturePad {
      border: 2px dashed #aaa;
      background: white;
    }
  </style>
</head>
<body class="bg-white bg-opacity-90 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold text-pink-600 mb-6">🎉 Orçamentos e Contratos - GilFest 🎉</h1>

  <!-- Dados do Cliente -->
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-3xl mb-6">
    <h2 class="text-xl font-semibold mb-4">Dados do Cliente</h2>
    <input id="clienteNome" placeholder="Nome do Cliente" class="w-full p-2 border rounded mb-2">
    <input id="clienteTelefone" placeholder="Telefone do Cliente" class="w-full p-2 border rounded mb-2">
    <input id="clienteEndereco" placeholder="Endereço do Cliente" class="w-full p-2 border rounded">
  </div>

  <!-- Serviços -->
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-3xl mb-6">
    <h2 class="text-xl font-semibold mb-4">Serviços</h2>
    <div id="servicos" class="space-y-2">
      <label><input type="number" min="0" value="0" class="qtd w-16 border rounded p-1" data-preco="2"> Algodão doce no saquinho (R$ 2,00)</label><br>
      <label><input type="number" min="0" value="0" class="qtd w-16 border rounded p-1" data-preco="2.5"> Algodão doce copo 300ml (R$ 2,50)</label><br>
      <label><input type="number" min="0" value="0" class="qtd w-16 border rounded p-1" data-preco="3"> Algodão doce copo 500ml (R$ 3,00)</label><br>
      <label><input type="number" min="0" value="0" class="qtd w-16 border rounded p-1" data-preco="5"> Pipoca gourmet 300ml (R$ 5,00)</label><br>
      <label><input type="number" min="0" value="0" class="qtd w-16 border rounded p-1" data-preco="2"> Pipoca caramelizada 300ml (R$ 2,00)</label><br>
      <label><input type="checkbox" class="chk" data-preco="399"> Cascata de chocolate pequena (R$ 399,00)</label><br>
      <label><input type="checkbox" class="chk" data-preco="399"> Crepe suíço (R$ 399,00)</label><br>
      <label><input type="checkbox" class="chk" data-preco="399"> Churros (R$ 399,00)</label><br>
      <label><input type="checkbox" class="chk" data-preco="200"> Máquina de algodão doce no evento (R$ 200,00)</label><br>
      <label><input type="checkbox" class="chk" data-preco="180"> Pula-pula grande (R$ 180,00)</label><br>
      <label><input type="checkbox" class="chk" data-preco="150"> Pula-pula médio (R$ 150,00)</label><br>
      <label><input type="checkbox" class="chk" data-preco="150"> Piscina de bolinhas (R$ 150,00)</label>
    </div>
    <p class="mt-4 font-semibold">💰 Total: R$ <span id="total">0,00</span></p>
    <p>🔑 Sinal (40%): R$ <span id="sinal">0,00</span></p>
    <p>📌 Saldo: R$ <span id="saldo">0,00</span></p>
  </div>

  <!-- Assinatura -->
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-3xl mb-6">
    <h2 class="text-xl font-semibold mb-2">Assinatura Digital</h2>
    <canvas id="signaturePad" width="600" height="150"></canvas>
    <button onclick="limparAssinatura()" class="mt-2 px-4 py-2 bg-red-500 text-white rounded">Limpar</button>
  </div>

  <!-- Botões -->
  <div class="flex space-x-4">
    <button onclick="gerarOrcamento()" class="px-4 py-2 bg-green-600 text-white rounded flex items-center gap-2">📄 Gerar Orçamento</button>
    <button onclick="gerarContrato()" class="px-4 py-2 bg-blue-600 text-white rounded flex items-center gap-2">📝 Gerar Contrato</button>
    <button onclick="enviarWhatsapp()" class="px-4 py-2 bg-orange-600 text-white rounded flex items-center gap-2">📲 Enviar WhatsApp</button>
  </div>

  <script>
    const sinalPercent = 0.4;
    const horaExtra = 100;

    function calcularTotal(){
      let total = 0;
      document.querySelectorAll(".qtd").forEach(input=>{
        total += parseFloat(input.dataset.preco) * parseInt(input.value||0);
      });
      document.querySelectorAll(".chk:checked").forEach(chk=>{
        total += parseFloat(chk.dataset.preco);
      });
      document.getElementById("total").textContent = total.toFixed(2).replace(".",",");
      document.getElementById("sinal").textContent = (total*sinalPercent).toFixed(2).replace(".",",");
      document.getElementById("saldo").textContent = (total-total*sinalPercent).toFixed(2).replace(".",",");
      return total;
    }
    document.querySelectorAll(".qtd,.chk").forEach(el=>el.addEventListener("input",calcularTotal));

    function getAssinatura(){
      return document.getElementById("signaturePad").toDataURL("image/png");
    }

    function limparAssinatura(){
      let ctx = document.getElementById("signaturePad").getContext("2d");
      ctx.clearRect(0,0,600,150);
    }

    // Funções PDF
    async function gerarOrcamento(){
      const { jsPDF } = window.jspdf;
      let doc = new jsPDF();
      doc.text("Orçamento - GilFest", 20,20);
      doc.text("Cliente: "+document.getElementById("clienteNome").value, 20,30);
      doc.text("Telefone: "+document.getElementById("clienteTelefone").value, 20,40);
      doc.text("Endereço: "+document.getElementById("clienteEndereco").value, 20,50);
      doc.text("Total: R$ "+document.getElementById("total").textContent, 20,70);
      doc.text("Sinal (40%): R$ "+document.getElementById("sinal").textContent, 20,80);
      doc.text("Saldo: R$ "+document.getElementById("saldo").textContent, 20,90);
      doc.addImage(getAssinatura(),"PNG",20,100,80,30);
      doc.save("orcamento.pdf");
    }

    async function gerarContrato(){
      const { jsPDF } = window.jspdf;
      let doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("CONTRATO DE PRESTAÇÃO DE SERVIÇOS - GILFEST", 20,20);
      doc.setFontSize(10);
      doc.text("Contratado: GilFest - CPF 045.761.515-09 - Tel: 79 99914-5044 - Endereço: Av. Principal do conjunto João Alves n°705, Nossa Senhora do Socorro/SE", 20,30,{maxWidth:170});
      doc.text("Contratante: "+document.getElementById("clienteNome").value, 20,50);
      doc.text("Telefone: "+document.getElementById("clienteTelefone").value, 20,60);
      doc.text("Endereço: "+document.getElementById("clienteEndereco").value, 20,70);
      doc.text("Valor Total: R$ "+document.getElementById("total").textContent, 20,90);
      doc.text("Sinal (40%): R$ "+document.getElementById("sinal").textContent+" - Saldo: R$ "+document.getElementById("saldo").textContent, 20,100);
      doc.text("Cláusula 1 - O contratado prestará os serviços de recreação, brinquedos e alimentação conforme descrição.",20,120,{maxWidth:170});
      doc.text("Cláusula 2 - O contratante pagará 40% como sinal na assinatura, e o saldo até a data do evento.",20,135,{maxWidth:170});
      doc.text("Cláusula 3 - Hora extra será cobrada no valor de R$ 100,00 por hora.",20,150,{maxWidth:170});
      doc.text("Cláusula 4 - Em caso de cancelamento, o sinal não será devolvido.",20,165,{maxWidth:170});
      doc.text("Assinaturas:",20,190);
      doc.addImage(getAssinatura(),"PNG",20,200,80,30);
      doc.text("Contratante ____________________",20,240);
      doc.text("Contratado - GilFest",120,240);
      doc.save("contrato.pdf");
    }

    function enviarWhatsapp(){
      let nome = document.getElementById("clienteNome").value;
      let total = document.getElementById("total").textContent;
      let msg = `Olá, aqui é da GilFest! 🎉\nSegue o resumo do orçamento:\nCliente: ${nome}\nTotal: R$ ${total}`;
      let url = "https://wa.me/5579999145044?text="+encodeURIComponent(msg);
      window.open(url,"_blank");
    }

    // Assinatura
    let canvas = document.getElementById("signaturePad");
    let ctx = canvas.getContext("2d");
    let drawing = false;
    canvas.addEventListener("mousedown",()=>drawing=true);
    canvas.addEventListener("mouseup",()=>drawing=false);
    canvas.addEventListener("mousemove",draw);
    function draw(e){
      if(!drawing) return;
      ctx.lineWidth = 2;
      ctx.lineCap = "round";
      ctx.strokeStyle = "#000";
      ctx.lineTo(e.offsetX,e.offsetY);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(e.offsetX,e.offsetY);
    }
  </script>
</body>
</html>
